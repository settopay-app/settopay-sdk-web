{"version":3,"sources":["../src/environments.ts","../src/errors.ts","../src/types.ts","../src/index.ts"],"names":["SETTO_ENVIRONMENTS","getBaseUrl","environment","SettoErrorCode","SettoError","code","message","PaymentStatus","MESSAGE_TYPES","OVERLAY_STYLES","IFRAME_STYLES","SettoSDK","config","params","resolve","reject","event","type","data","rejectFn"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\r\n * Setto SDK 환경 설정\r\n *\r\n * bindings/ SDK는 독립적으로 배포되므로 자체 환경 상수를 정의합니다.\r\n */\r\n\r\nexport const SETTO_ENVIRONMENTS = {\r\n  /** SDK 로컬 개발용 (배포 빌드에서 제외) */\r\n  local: 'http://localhost:3100',\r\n  /** 개발 환경 */\r\n  development: 'https://dev-wallet.settopay.com',\r\n  /** 프로덕션 환경 */\r\n  production: 'https://wallet.settopay.com',\r\n} as const;\r\n\r\nexport type SettoEnvironment = keyof typeof SETTO_ENVIRONMENTS;\r\n\r\n/**\r\n * 환경에 해당하는 Base URL 반환\r\n */\r\nexport function getBaseUrl(environment: SettoEnvironment): string {\r\n  return SETTO_ENVIRONMENTS[environment];\r\n}\r\n","/**\r\n * Setto SDK 에러 코드\r\n *\r\n * Deep Link의 error 파라미터 및 SDK 내부에서 사용\r\n */\r\nexport const SettoErrorCode = {\r\n  // 사용자 액션\r\n  USER_CANCELLED: 'USER_CANCELLED',\r\n\r\n  // 결제 실패\r\n  PAYMENT_FAILED: 'PAYMENT_FAILED',\r\n  INSUFFICIENT_BALANCE: 'INSUFFICIENT_BALANCE',\r\n  TRANSACTION_REJECTED: 'TRANSACTION_REJECTED',\r\n\r\n  // 네트워크/시스템\r\n  NETWORK_ERROR: 'NETWORK_ERROR',\r\n  SESSION_EXPIRED: 'SESSION_EXPIRED',\r\n\r\n  // 파라미터\r\n  INVALID_PARAMS: 'INVALID_PARAMS',\r\n  INVALID_MERCHANT: 'INVALID_MERCHANT',\r\n} as const;\r\n\r\nexport type SettoErrorCodeType = (typeof SettoErrorCode)[keyof typeof SettoErrorCode];\r\n\r\n/**\r\n * Setto SDK 에러 클래스\r\n */\r\nexport class SettoError extends Error {\r\n  readonly code: SettoErrorCodeType;\r\n\r\n  constructor(code: SettoErrorCodeType, message?: string) {\r\n    super(message ?? code);\r\n    this.name = 'SettoError';\r\n    this.code = code;\r\n  }\r\n\r\n  /**\r\n   * 사용자 취소 에러인지 확인\r\n   */\r\n  isUserCancelled(): boolean {\r\n    return this.code === SettoErrorCode.USER_CANCELLED;\r\n  }\r\n\r\n  /**\r\n   * 결제 관련 에러인지 확인\r\n   */\r\n  isPaymentError(): boolean {\r\n    const paymentErrorCodes: SettoErrorCodeType[] = [\r\n      SettoErrorCode.PAYMENT_FAILED,\r\n      SettoErrorCode.INSUFFICIENT_BALANCE,\r\n      SettoErrorCode.TRANSACTION_REJECTED,\r\n    ];\r\n    return paymentErrorCodes.includes(this.code);\r\n  }\r\n}\r\n","/**\r\n * Setto Web SDK 타입 정의\r\n */\r\n\r\nimport type { SettoEnvironment } from './environments';\r\n\r\n// ============================================================================\r\n// SDK 설정\r\n// ============================================================================\r\n\r\n/**\r\n * SDK 초기화 설정\r\n */\r\nexport interface SettoSDKConfig {\r\n  /** 고객사 ID */\r\n  merchantId: string;\r\n  /** 환경 설정 */\r\n  environment: SettoEnvironment;\r\n}\r\n\r\n// ============================================================================\r\n// 결제 요청/결과\r\n// ============================================================================\r\n\r\n/**\r\n * 결제 요청 파라미터\r\n */\r\nexport interface PaymentParams {\r\n  /** 고객사 IdP Token (Firebase, Cognito 등) */\r\n  idpToken?: string;\r\n  /** 주문 ID */\r\n  orderId: string;\r\n  /** 결제 금액 */\r\n  amount: number;\r\n  /** 통화 (기본: USD) */\r\n  currency?: string;\r\n}\r\n\r\n/**\r\n * 결제 상태\r\n */\r\nexport const PaymentStatus = {\r\n  SUCCESS: 'success',\r\n  FAILED: 'failed',\r\n  CANCELLED: 'cancelled',\r\n} as const;\r\n\r\nexport type PaymentStatusType = (typeof PaymentStatus)[keyof typeof PaymentStatus];\r\n\r\n/**\r\n * 결제 결과\r\n */\r\nexport interface PaymentResult {\r\n  /** 결제 상태 */\r\n  status: PaymentStatusType;\r\n  /** 블록체인 트랜잭션 해시 (성공 시) */\r\n  txId?: string;\r\n  /** Setto 결제 ID */\r\n  paymentId?: string;\r\n  /** 에러 메시지 (실패 시) */\r\n  error?: string;\r\n}\r\n\r\n// ============================================================================\r\n// postMessage 타입\r\n// ============================================================================\r\n\r\n/**\r\n * postMessage 메시지 타입\r\n * wallet.settopay.com과 동기화 필요\r\n */\r\nexport const MESSAGE_TYPES = {\r\n  /** 결제 초기화 요청 */\r\n  INIT_PAYMENT: 'INIT_PAYMENT',\r\n  /** 결제 성공 */\r\n  PAYMENT_SUCCESS: 'PAYMENT_SUCCESS',\r\n  /** 결제 실패 */\r\n  PAYMENT_FAILED: 'PAYMENT_FAILED',\r\n  /** 결제 취소 */\r\n  PAYMENT_CANCELLED: 'PAYMENT_CANCELLED',\r\n} as const;\r\n\r\nexport type MessageType = (typeof MESSAGE_TYPES)[keyof typeof MESSAGE_TYPES];\r\n\r\n/**\r\n * 결제 초기화 메시지 (SDK → wallet.settopay.com)\r\n */\r\nexport interface InitPaymentMessage {\r\n  type: typeof MESSAGE_TYPES.INIT_PAYMENT;\r\n  merchantId: string;\r\n  orderId: string;\r\n  amount: number;\r\n  currency?: string;\r\n  idpToken?: string;\r\n}\r\n\r\n/**\r\n * 결제 결과 메시지 (wallet.settopay.com → SDK)\r\n */\r\nexport interface PaymentResultMessage {\r\n  type:\r\n    | typeof MESSAGE_TYPES.PAYMENT_SUCCESS\r\n    | typeof MESSAGE_TYPES.PAYMENT_FAILED\r\n    | typeof MESSAGE_TYPES.PAYMENT_CANCELLED;\r\n  data: PaymentResult;\r\n}\r\n","/**\r\n * Setto Web SDK\r\n *\r\n * iframe + postMessage 방식으로 wallet.settopay.com과 통신하여 결제를 처리합니다.\r\n *\r\n * @example\r\n * ```typescript\r\n * import { SettoSDK } from '@setto/web-sdk';\r\n *\r\n * const setto = new SettoSDK({\r\n *   merchantId: 'merchant-123',\r\n *   environment: 'production',\r\n * });\r\n *\r\n * const result = await setto.openPayment({\r\n *   orderId: 'order-456',\r\n *   amount: 10000,\r\n *   idpToken: await getFirebaseIdToken(),\r\n * });\r\n * ```\r\n */\r\n\r\nimport { getBaseUrl } from './environments';\r\nimport { SettoError, SettoErrorCode } from './errors';\r\nimport {\r\n  MESSAGE_TYPES,\r\n  type InitPaymentMessage,\r\n  type PaymentParams,\r\n  type PaymentResult,\r\n  type PaymentResultMessage,\r\n  type SettoSDKConfig,\r\n} from './types';\r\n\r\n// ============================================================================\r\n// CSS 스타일 상수\r\n// ============================================================================\r\n\r\nconst OVERLAY_STYLES = `\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  z-index: 9999;\r\n`;\r\n\r\nconst IFRAME_STYLES = `\r\n  position: fixed;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  width: 400px;\r\n  height: 600px;\r\n  max-width: 95vw;\r\n  max-height: 90vh;\r\n  border: none;\r\n  border-radius: 12px;\r\n  z-index: 10000;\r\n`;\r\n\r\n// ============================================================================\r\n// SettoSDK 클래스\r\n// ============================================================================\r\n\r\n/**\r\n * Setto Web SDK\r\n *\r\n * 고객사 웹사이트에서 Setto 결제를 연동하기 위한 SDK입니다.\r\n * iframe으로 wallet.settopay.com을 로드하고 postMessage로 통신합니다.\r\n */\r\nexport class SettoSDK {\r\n  private readonly merchantId: string;\r\n  private readonly baseUrl: string;\r\n\r\n  private iframe: HTMLIFrameElement | null = null;\r\n  private overlay: HTMLDivElement | null = null;\r\n  private messageHandler: ((event: MessageEvent) => void) | null = null;\r\n  private rejectHandler: ((error: Error) => void) | null = null;\r\n\r\n  constructor(config: SettoSDKConfig) {\r\n    this.merchantId = config.merchantId;\r\n    this.baseUrl = getBaseUrl(config.environment);\r\n  }\r\n\r\n  /**\r\n   * 결제 창을 열고 결제를 진행합니다.\r\n   *\r\n   * @param params 결제 파라미터\r\n   * @returns 결제 결과 Promise\r\n   * @throws {SettoError} 결제 실패 또는 사용자 취소 시\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * try {\r\n   *   const result = await setto.openPayment({\r\n   *     orderId: 'order-456',\r\n   *     amount: 10000,\r\n   *     idpToken: await getFirebaseIdToken(),\r\n   *   });\r\n   *   console.log('결제 성공:', result.txId);\r\n   * } catch (error) {\r\n   *   if (error instanceof SettoError && error.isUserCancelled()) {\r\n   *     console.log('사용자가 결제를 취소했습니다.');\r\n   *   } else {\r\n   *     console.error('결제 실패:', error);\r\n   *   }\r\n   * }\r\n   * ```\r\n   */\r\n  openPayment(params: PaymentParams): Promise<PaymentResult> {\r\n    return new Promise((resolve, reject) => {\r\n      this.rejectHandler = reject;\r\n\r\n      // UI 생성\r\n      this.createOverlay();\r\n      this.createIframe();\r\n\r\n      // iframe 로드 완료 시 결제 초기화 메시지 전송\r\n      this.iframe!.onload = () => {\r\n        const message: InitPaymentMessage = {\r\n          type: MESSAGE_TYPES.INIT_PAYMENT,\r\n          merchantId: this.merchantId,\r\n          orderId: params.orderId,\r\n          amount: params.amount,\r\n          currency: params.currency,\r\n          idpToken: params.idpToken,\r\n        };\r\n        this.iframe!.contentWindow?.postMessage(message, this.baseUrl);\r\n      };\r\n\r\n      // 결제 결과 메시지 수신\r\n      this.messageHandler = (event: MessageEvent) => {\r\n        // origin 검증 (보안)\r\n        if (event.origin !== this.baseUrl) return;\r\n\r\n        const { type, data } = event.data as PaymentResultMessage;\r\n\r\n        switch (type) {\r\n          case MESSAGE_TYPES.PAYMENT_SUCCESS:\r\n            this.cleanup();\r\n            resolve(data);\r\n            break;\r\n\r\n          case MESSAGE_TYPES.PAYMENT_FAILED:\r\n            this.cleanup();\r\n            reject(new SettoError(SettoErrorCode.PAYMENT_FAILED, data.error));\r\n            break;\r\n\r\n          case MESSAGE_TYPES.PAYMENT_CANCELLED:\r\n            this.cleanup();\r\n            reject(new SettoError(SettoErrorCode.USER_CANCELLED));\r\n            break;\r\n        }\r\n      };\r\n\r\n      window.addEventListener('message', this.messageHandler);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 오버레이 생성\r\n   */\r\n  private createOverlay(): void {\r\n    this.overlay = document.createElement('div');\r\n    this.overlay.id = 'setto-overlay';\r\n    this.overlay.style.cssText = OVERLAY_STYLES;\r\n\r\n    // 오버레이 클릭 시 결제 취소\r\n    this.overlay.onclick = (e) => {\r\n      if (e.target === this.overlay) {\r\n        const rejectFn = this.rejectHandler;\r\n        this.cleanup();\r\n        rejectFn?.(new SettoError(SettoErrorCode.USER_CANCELLED));\r\n      }\r\n    };\r\n\r\n    document.body.appendChild(this.overlay);\r\n  }\r\n\r\n  /**\r\n   * iframe 생성\r\n   */\r\n  private createIframe(): void {\r\n    this.iframe = document.createElement('iframe');\r\n    this.iframe.id = 'setto-iframe';\r\n    this.iframe.src = `${this.baseUrl}/embed`;\r\n    this.iframe.style.cssText = IFRAME_STYLES;\r\n\r\n    document.body.appendChild(this.iframe);\r\n  }\r\n\r\n  /**\r\n   * 리소스 정리\r\n   */\r\n  private cleanup(): void {\r\n    // 이벤트 리스너 제거\r\n    if (this.messageHandler) {\r\n      window.removeEventListener('message', this.messageHandler);\r\n      this.messageHandler = null;\r\n    }\r\n\r\n    // DOM 요소 제거\r\n    this.iframe?.remove();\r\n    this.overlay?.remove();\r\n    this.iframe = null;\r\n    this.overlay = null;\r\n    this.rejectHandler = null;\r\n  }\r\n\r\n  /**\r\n   * 현재 결제 창을 강제로 닫습니다.\r\n   * 일반적으로 사용자가 직접 호출할 필요는 없습니다.\r\n   */\r\n  close(): void {\r\n    const rejectFn = this.rejectHandler;\r\n    this.cleanup();\r\n    rejectFn?.(new SettoError(SettoErrorCode.USER_CANCELLED));\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// 타입 및 상수 Export\r\n// ============================================================================\r\n\r\nexport { SettoError, SettoErrorCode } from './errors';\r\nexport { SETTO_ENVIRONMENTS, type SettoEnvironment } from './environments';\r\nexport {\r\n  MESSAGE_TYPES,\r\n  PaymentStatus,\r\n  type PaymentParams,\r\n  type PaymentResult,\r\n  type PaymentStatusType,\r\n  type SettoSDKConfig,\r\n} from './types';\r\n"]}